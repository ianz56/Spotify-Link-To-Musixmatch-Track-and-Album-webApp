{% extends 'base.html' %}

{% block title %}{{ _("Apple Music to Musixmatch Link") }}{% endblock %}
{% block content %}
  <div class="container">
    <h1>{{ _("Apple Music to Musixmatch Link") }}</h1>
    <form action="/apple" method="GET">
      <label for="input_link">{{ _("Apple Music Track Link:") }}</label>
      <input type="text"
             id="input_link"
             name="link"
             placeholder="{{ _("E.g.:") }} https://music.apple.com/us/album/song-name/123456?i=123456" />
      <button type="submit" id="process_button">{{ _("Get links") }}</button>
      <div class="loading" id="loading"></div>
    </form>
    <div class="output" id="output">
      {% if tracks_data %}
        <div class="row">
          {% for track in tracks_data %}
            {% if track.isrc or track.track_isrc %}
              <div class="col-sm-6 col-md-4 col-lg-3">
                <div class="card">
                  <img src="{{ track.image }}" alt="{{ track.track_name }}" />
                  <div class="card-details">
                    <h5 class="card-title">
                      {{ track.track_name }}
                      {% if track.lyrics_published_status %}
                        {% if track.lyrics_published_status == 1 %}
                          <span class="badge-status badge-mxm">{{ _("Musixmatch") }}</span>
                        {% elif track.lyrics_published_status == 3 %}
                          <span class="badge-status badge-mxm">{{ _("Musixmatch (Stricted)") }}</span>
                        {% elif track.lyrics_published_status == 15 %}
                          <span class="badge-status badge-curator">{{ _("Curator") }}</span>
                        {% elif track.lyrics_published_status == 5 %}
                          <span class="badge-status badge-curator">{{ _("Curator (Locked)") }}</span>
                        {% elif track.lyrics_published_status == 16 %}
                          <span class="badge-status badge-community">{{ _("Community") }}</span>
                        {% elif track.lyrics_published_status == 13 %}
                          <span class="badge-status badge-artist">{{ _("Artist") }}</span>
                        {% else %}
                          <span class="badge-status badge-unknown"
                                title="Status Code: {{ track.lyrics_published_status }}">{{ _("Unknown") }}</span>
                        {% endif %}
                      {% endif %}
                    </h5>
                    {% if track.matcher_album %}
                      <p class="card-text">
                        Album:
                        <a href="https://www.musixmatch.com/album/{{ track.artist_id }}/{{ track.matcher_album[0] }}"
                           class="card-link"
                           target="_blank">{{ track.matcher_album[1] }}</a>
                      </p>
                    {% else %}
                      <p class="card-text">
                        Album:
                        <a href="https://www.musixmatch.com/album/{{ track.artist_id }}/{{ track.album_id }}"
                           class="card-link"
                           target="_blank">{{ track.album_name }}</a>
                      </p>
                    {% endif %}
                    <p class="card-text">{{ _("Artist:") }} {{ track.artist_name }}</p>
                    <p class="card-text">ISRC: {{ track.isrc or track.track_isrc }}</p>
                    <p class="card-text">Track ID: {{ track.commontrack_id }}</p>
                    <p class="card-text">
                      Link:
                      <a href="{{ track.track_share_url.split("?")[0] }}"
                         class="card-link"
                         target="_blank">Musixmatch</a>
                    </p>
                    {% if track.note %}<p class="card-text">{{ _("Note:") }} {{ track.note|safe }}</p>{% endif %}
                    {% if is_cached %}
                      <div class="cached-info">
                        <span class="badge-cached" title="{{ _("Data fetched from cache") }}">
                          <svg xmlns="http://www.w3.org/2000/svg"
                               width="12"
                               height="12"
                               viewBox="0 0 24 24"
                               fill="none"
                               stroke="currentColor"
                               stroke-width="3"
                               stroke-linecap="round"
                               stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                          </svg>
                          {{ _("Cached") }}
                        </span>
                        {% if cached_timestamp %}
                          <span>{{ cached_timestamp.strftime("%H:%M") }}</span>
                        {% endif %}
                        <span>&bull;</span>
                        <a href="{{ url_for('apple', link=request.args.get('link') , refresh='true') }}"
                           class="refresh-btn">{{ _("Refresh") }}</a>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% else %}
              <div class="col-sm-6 col-md-4 col-lg-3">
                <div class="card">
                  <p class="card-text">{{ track }}</p>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
